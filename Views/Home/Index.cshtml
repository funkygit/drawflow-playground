@{
    ViewData["Title"] = "Workflow Editor";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.css">
<style>
    #drawflow {
        width: 100%;
        height: 600px;
        border: 1px solid #ccc;
        position: relative;
    }
    .node-status {
        position: absolute;
        top: -10px;
        right: -10px;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: gray;
        border: 1px solid white;
    }
    .status-running { background-color: yellow; }
    .status-completed { background-color: green; }
    .status-failed { background-color: red; }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-7">
            <div id="drawflow"></div>
        </div>
        <div class="col-md-2" id="node-list-container">
            <h4>Available Nodes</h4>
            <div id="available-nodes" class="list-group">
                <!-- Dynamically populated -->
            </div>
            <hr />
            <h4>Legacy Nodes</h4>
            <div class="drag-drawflow" draggable="true" ondragstart="drag(event)" data-node="start">
                <i class="fas fa-play"></i><span> Start</span>
            </div>
            <div class="drag-drawflow" draggable="true" ondragstart="drag(event)" data-node="end">
                <i class="fas fa-stop"></i><span> End</span>
            </div>
            <div class="drag-drawflow" draggable="true" ondragstart="drag(event)" data-node="loop">
                <i class="fas fa-sync"></i><span> Loop</span>
            </div>
            <div class="drag-drawflow" draggable="true" ondragstart="drag(event)" data-node="conditional">
                <i class="fas fa-question-circle"></i><span> Conditional</span>
            </div>
            <div class="drag-drawflow" draggable="true" ondragstart="drag(event)" data-node="iterator">
                <i class="fas fa-list-ol"></i><span> Iterator</span>
            </div>
        </div>
        <div class="col-md-3">
            <h3>Controls</h3>
            <button class="btn btn-primary w-100 mb-2" onclick="saveWorkflow()">Save Workflow</button>
            <button class="btn btn-success w-100 mb-2" onclick="runWorkflow()">Run Workflow</button>
            
            <hr />
            <div id="node-config-panel" style="display:none; border: 1px solid #ddd; padding: 10px; border-radius: 5px; background: #f9f9f9;">
                <h4>Node Config</h4>
                <div id="node-info" class="mb-2">
                    <strong id="config-node-name"></strong> <span id="config-node-id" class="text-muted small"></span>
                </div>
                <!-- Variant Selector -->
                <div id="variant-selector-container" class="mb-3">
                    <label>Module Variant</label>
                    <select id="variant-selector" class="form-select"></select>
                </div>
                <!-- Dynamic Form -->
                <div id="dynamic-form-container"></div>
                
                <button class="btn btn-sm btn-secondary mt-2 w-100" onclick="updateNodeData()">Update Node</button>
            </div>

            <hr />
            <h4>Log</h4>
            <div id="log" style="height: 150px; overflow-y: scroll; border: 1px solid #eee; font-size: 0.8em;"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script src="/js/dynamic-form-renderer.js"></script>
<script src="/js/workflow-manager.js"></script>
<script src="/js/index-controller.js"></script>
